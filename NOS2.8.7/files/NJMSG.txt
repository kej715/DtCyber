      PROGRAM NJMSG

      IMPLICIT INTEGER (A-Z)
      DIMENSION HDR(10),NIT(10,12),TA(20)
      DIMENSION MEM(1)
      CHARACTER*1   MTYPE
      CHARACTER*8   FUSER,FNODE,TUSER
      CHARACTER*150 TEXT

      CCDR = O"70"
      DO 1 I = 1,8
        PRINT '(1X,A10,1X,O20)',MEM(CCDR - LOCF(MEM(1)) + I)
 1    CONTINUE
      CALL NJMOPEN(HDR,ACN,RC,"AP1",1)
      IF (RC.NE.0) THEN
        CALL DISPLA('FAILED TO CONNECT TO NJF, RC =',RC)
        CALL NJMABT
      ENDIF
      CALL NJMSETU(HDR,ACN,RC,'*')
      IF (RC.NE.0) THEN
        CALL DISPLA('FAILED TO SET USER, RC =',RC)
        CALL NJMABT
      ENDIF
      L = 0
 10   CONTINUE
      CALL NJMPOLL(HDR,CN,RC,10,TA,20)
      IF (RC.EQ.0) THEN
        CALL NJMRECV(TA,MTYPE,FUSER,FNODE,TUSER,TEXT,TEXTL,RC)
        IF (MTYPE.EQ.'S') THEN
          IF (RC.NE.0) THEN
            CALL DISPLA('REQUEST FAILED, RC =',RC)
            CALL NJMABT
          ENDIF
        ELSEIF (MTYPE.EQ.'M') THEN
          PRINT 11,FUSER,FNODE,TUSER,TEXTL
 11       FORMAT(' FROM ',A,' AT ',A,' TO ',A,' LEN ',I3)
          PRINT '(1X,A)',TEXT(1:TEXTL)
        ENDIF
        L = L + 1
        IF (L.GT.1) GOTO 10
        CALL NJMSEND(HDR,ACN,RC,'HERC01','NCCMVS','HELLO FROM NCCM01!')
        IF (RC.NE.0) THEN
          CALL DISPLA('FAILED TO SEND MESSAGE, RC =',RC)
          CALL NJMABT
        ENDIF
        GO TO 10
      ELSE IF (RC.EQ.1) THEN
        GO TO 10
      ELSE IF (RC.EQ.6) THEN
        CALL REMARK('CONNECTION ENDED')
        GO TO 20
      ELSE IF (RC.EQ.13) THEN
        CALL REMARK('CONNECTION REJECTED')
        GO TO 20
      ELSE
        CALL DISPLA('UNRECOGNIZED QTRM STATUS ', RC)
        CALL NJMABT
      ENDIF

 20   CONTINUE

      END
          IDENT  ARG
          ENTRY  ARG=
 ARG=     BSS    0
          END
